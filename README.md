# Commute Tracker

A Next.js application for tracking commute data with MongoDB backend.

## Features

- Track daily commute entries (date, work location)
- Automatic work location detection based on WiFi SSID
- View commute summaries
- RESTful API endpoints for data management
- MongoDB database for data storage
- Automatic database seeding on app start

## Prerequisites

- Node.js (v18 or higher)
- MongoDB running locally on `mongodb://localhost:27017`

## Getting Started

1. Install dependencies:
```bash
npm install
```

2. Ensure MongoDB is running locally on `mongodb://localhost:27017`

3. Run the development server:
```bash
npm run dev
```

4. Open [http://localhost:3000](http://localhost:3000) in your browser

**Note:** The database will be automatically seeded with data from `commute.json` on first app start if the database is empty.

## API Endpoints

### GET /api/commute
Returns commute entries with one record per day. If multiple entries exist for the same day, "office" entries override "home" entries.

**Response:**
```json
{
  "data": [
    {
      "id": "507f1f77bcf86cd799439011",
      "date": "01-09-2025",
      "workLocation": "office",
      "user": "test@rtl.nl"
    }
  ]
}
```

**Note:** 
- Date format is `dd-mm-yyyy`
- Returns one entry per unique date
- "office" entries take precedence over "home" entries for the same date

### POST /api/commute
Accepts JSON payload with user (email) and WiFi information. Automatically determines work location based on WiFi SSID prefix.

**Request Body:** JSON (application/json)

**Format:**
```json
{
  "user": "user@example.com",
  "wifi": "SSID_NAME"
}
```

**Work Location Logic:**
- If WiFi SSID starts with "RTL" or "DPG" → `workLocation = "office"`
- Otherwise → `workLocation = "home"`

**Example:**
```json
{
  "user": "john@example.com",
  "wifi": "RTL-Office-WiFi"
}
```

**Response:**
```json
{
  "ok": true,
  "id": "507f1f77bcf86cd799439011"
}
```

**Note:** 
- The date field is automatically set to today's date in `dd-mm-yyyy` format
- The `user` field (email address) is saved to the database
- The `wifi` field is used for location detection but not saved to the database

## Database

The application uses MongoDB with:
- **Connection URI**: `mongodb://localhost:27017` (hardcoded)
- **Database name**: `commuteTracker` (hardcoded)
- **Collection name**: `commuteEntries`

### Data Model

**CommuteEntry:**
```typescript
{
  id: string;                    // Auto-generated by MongoDB
  date: string;                  // dd-mm-yyyy format
  workLocation?: "office" | "home";
  commuteType?: "car" | "public_transport";
  status?: "working" | "not_working";
  user?: string;                 // Email address
}
```

### Seeding

The database is automatically seeded on app start if it's empty. The seed data comes from `data/commute.json` and includes:
- All entries from the JSON file
- `user` field set to `"test@rtl.nl"` for all seeded entries

## Project Structure

```
commute-tracker/
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   └── commute/
│   │   │       └── route.ts      # API endpoints (GET, POST)
│   │   ├── page.tsx              # Main page
│   │   └── summary/
│   │       └── page.tsx          # Summary page
│   ├── components/
│   │   └── ui/                   # UI components
│   └── lib/
│       ├── mongodb.ts            # MongoDB connection
│       ├── init-db.ts            # Database initialization
│       ├── seed-db.ts            # Database seeding logic
│       └── utils.ts              # Utility functions
└── data/
    └── commute.json               # Seed data (legacy, used for initial seeding)
```

## Tech Stack

- **Framework**: Next.js 16
- **Database**: MongoDB
- **Language**: TypeScript
- **Styling**: Tailwind CSS

## Learn More

- [Next.js Documentation](https://nextjs.org/docs)
- [MongoDB Node.js Driver](https://www.mongodb.com/docs/drivers/node/current/)
